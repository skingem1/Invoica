---
title: x402 Protocol
description: "Understanding the x402 payment protocol and how Invoica extends it with financial compliance."
---

# x402 Protocol

The x402 protocol enables machine-to-machine payments on the web. Invoica extends x402 with financial compliance — invoicing, tax calculation, budget enforcement, and settlement detection.

## How x402 Works

The x402 protocol uses HTTP status code 402 (Payment Required) to signal that a resource requires payment:

```
1. Agent requests a resource
2. Server responds with 402 + payment details
3. Agent signs and sends payment
4. Server verifies payment and grants access
```

## Standard x402 Flow

```
AI Agent                    Resource Server
   |                              |
   |-- GET /resource ----------->|
   |<- 402 Payment Required -----|
   |   (price, token, address)   |
   |                              |
   |-- GET /resource ----------->|
   |   X-402-Payment: <signed>   |
   |<- 200 OK + resource --------|
```

## With Invoica Middleware

Invoica sits as a transparent proxy between the agent and the resource server:

```
AI Agent        Invoica Middleware        Resource Server
   |                   |                        |
   |-- GET /resource ->|                        |
   |                   |-- GET /resource ------>|
   |                   |<- 402 Payment Req. ----|
   |<- 402 + invoice --|                        |
   |                   |                        |
   |-- Payment ------->|                        |
   |                   |  * Generate Invoice    |
   |                   |  * Calculate Tax       |
   |                   |  * Check Budget        |
   |                   |  * Forward Payment     |
   |                   |-- Payment ------------>|
   |                   |<- 200 OK --------------|
   |<- 200 OK + PDF ---|                        |
```

## What Invoica Adds

| Capability | Standard x402 | With Invoica |
|------------|--------------|--------------|
| Payment | Yes | Yes |
| Invoice Generation | No | Automatic |
| Tax Calculation | No | Multi-jurisdiction |
| Budget Enforcement | No | Per-agent limits |
| Settlement Detection | Basic | Dual (poll + event) |
| Audit Trail | No | Full ledger |
| PDF Delivery | No | Automatic |

## x402 Headers

Invoica uses standard x402 headers plus additional invoice headers:

```http
X-402-Payment: <base64-encoded-signed-payment>
X-Invoice-Buyer: Acme AI Corp
X-Invoice-Tax-Id: US-12345
X-Invoice-Budget-Id: budget_agent_001
```

## Supported Networks

Invoica supports settlement detection on:

- **Ethereum Mainnet** — ERC-20 token transfers
- **Base** — Low-cost L2 transactions
- **Arbitrum** — Optimistic rollup settlements
- **Solana** — SPL token transfers
